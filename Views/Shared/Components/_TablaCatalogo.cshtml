@model IEnumerable<Highdmin.ViewModels.ICatalogoItem>
@{
    var controllerName = ViewBag.ControllerName ?? "Catalogo";
    var titulo = ViewBag.Titulo ?? "Catálogo";
    var descripcion = ViewBag.Descripcion ?? "Gestione los elementos del catálogo";
    var iconoTabla = ViewBag.IconoTabla ?? "ri-settings-line";
    var totalItems = ViewBag.TotalItems ?? 0;
    var labelSingular = ViewBag.LabelSingular ?? "elemento";
    var labelPlural = ViewBag.LabelPlural ?? "elementos";
    var tableId = ViewBag.TableId ?? "catalogoTable";
}

<!-- Main Content Card -->
<div class="card">
    <div class="card-header">
        <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
                <div class="avatar-sm">
                    <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-5">
                        <i class="@iconoTabla"></i>
                    </span>
                </div>
            </div>
            <div class="flex-grow-1 ms-3">
                <h5 class="card-title mb-1">@titulo (@totalItems)</h5>
                <p class="text-muted mb-0">@descripcion</p>
            </div>
        </div>
    </div>
    <div class="card-body">
        <!-- Search and Filter Bar -->
        <div class="row g-3 mb-4">
            <div class="col-xxl-5 col-sm-6">
                <div class="search-box">
                    <input type="text" class="form-control search" placeholder="Buscar por código o nombre...">
                    <i class="ri-search-line search-icon"></i>
                </div>
            </div>
            <div class="col-xxl-2 col-sm-6">
                <div>
                    <select class="form-control" data-choices data-choices-search-false name="choices-single-default2" id="statusFilter">
                        <option value="">Todos los estados</option>
                        <option value="Activo">Activos</option>
                        <option value="Inactivo">Inactivos</option>
                    </select>
                </div>
            </div>
            <div class="col-xxl-2 col-sm-4">
                <div>
                    <button type="button" class="btn btn-primary w-100" onclick="SearchData();"> <i class="ri-equalizer-fill me-2 align-bottom"></i>Filtros</button>
                </div>
            </div>
            <div class="col-xxl-1 col-sm-4">
                <div>
                    <button type="button" class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#showModal"><i class="ri-add-fill me-1 align-bottom"></i> Agregar</button>
                </div>
            </div>
        </div>

        <!-- Alert Messages -->
        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="ri-check-double-line me-3 align-middle fs-16"></i><strong>¡Éxito!</strong> @TempData["Success"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="ri-error-warning-line me-3 align-middle fs-16"></i><strong>¡Error!</strong> @TempData["Error"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        <!-- Data Table -->
        <div class="table-responsive table-card mt-3 mb-1">
            <table class="table align-middle table-nowrap" id="@tableId" style="width:100%">
                <thead class="table-light">
                    <tr>
                        <th class="sort" data-sort="codigo">Código</th>
                        <th class="sort" data-sort="nombre">Nombre</th>
                        <th class="sort" data-sort="descripcion">Descripción</th>
                        <th class="sort" data-sort="estado">Estado</th>
                        <th class="sort" data-sort="fecha">Fecha Creación</th>
                        <th class="sort" data-sort="action">Acciones</th>
                    </tr>
                </thead>
                <tbody class="list form-check-all">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="codigo">
                                <span class="badge bg-primary-subtle text-primary fs-12">@item.Codigo</span>
                            </td>
                            <td class="nombre">
                                <div class="d-flex align-items-center">
                                    <div class="avatar-xs me-3">
                                        <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-16">
                                            <i class="ri-user-line"></i>
                                        </span>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="fs-14 mb-0">@item.Nombre</h6>
                                    </div>
                                </div>
                            </td>
                            <td class="descripcion">
                                <span class="text-muted">@(string.IsNullOrEmpty(item.Descripcion) ? "Sin descripción" : item.Descripcion)</span>
                            </td>
                            <td class="estado">
                                <span class="@item.EstadoClass">@item.EstadoTexto</span>
                            </td>
                            <td class="fecha">
                                <span class="text-muted">@item.FechaCreacion.ToString("yyyy-MM-dd")</span>
                            </td>
                            <td>
                                <div class="d-flex gap-2">
                                    <div class="edit">
                                        <button class="btn btn-sm btn-success edit-item-btn" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#showModal"
                                                onclick="editItem(@item.Id, '@item.Codigo', '@item.Nombre', '@item.Descripcion', @item.Estado.ToString().ToLower())">
                                            <i class="ri-pencil-fill align-bottom"></i>
                                        </button>
                                    </div>
                                    <div class="remove">
                                        <button class="btn btn-sm btn-danger remove-item-btn" 
                                                onclick="deleteItem(@item.Id, '@item.Nombre')">
                                            <i class="ri-delete-bin-fill align-bottom"></i>
                                        </button>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            @if (!Model.Any())
            {
                <div class="noresult" style="display: block;">
                    <div class="text-center">
                        <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop" colors="primary:#121331,secondary:#08a88a" style="width:75px;height:75px"></lord-icon>
                        <h5 class="mt-2">¡Lo siento! No se encontraron resultados</h5>
                        <p class="text-muted mb-0">No hay @labelPlural registrados en el sistema.</p>
                    </div>
                </div>
            }
        </div>

        <div class="d-flex justify-content-end">
            <div class="pagination-wrap hstack gap-2" style="display: flex;">
                <a class="page-item pagination-prev disabled" href="javascript:void(0);">
                    Anterior
                </a>
                <ul class="pagination listjs-pagination mb-0">
                    <li class="active"><a class="page" href="#" data-i="1" data-page="8">1</a></li>
                </ul>
                <a class="page-item pagination-next" href="javascript:void(0);">
                    Siguiente
                </a>
            </div>
        </div>
    </div>
</div>