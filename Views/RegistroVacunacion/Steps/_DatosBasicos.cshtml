@model RegistroVacunacionItemViewModel

<div class="card border-0">
    <div class="card-header bg-primary text-white">
        <h6 class="mb-0 text-white">
            <i class="ri-user-line me-1"></i> Datos B치sicos
        </h6>
    </div>
    <div class="card-body">
        <!-- Datos Iniciales -->
        <div class="row mb-4">
            <div class="col-md-12">
                <h6 class="text-muted mb-3">
                    <i class="ri-file-text-line me-1"></i> Datos Iniciales
                </h6>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="consecutivo" class="form-label">Consecutivo</label>
                    <input type="text" id="consecutivo" name="Consecutivo" class="form-control" value="20250930195"
                        readonly>
                    <small class="text-muted">N칰mero generado autom치ticamente</small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="FechaAtencion" class="form-label">Fecha de atenci칩n <span
                            class="text-danger">*</span></label>
                    <input type="date" id="FechaAtencion" asp-for="FechaAtencion" class="form-control"
                        value="2025-01-10">
                    <small class="text-muted">Formato: 01/10/2025</small>
                </div>
            </div>
        </div>

        <!-- Datos B치sicos del Paciente -->
        <div class="row">
            <div class="col-md-12">
                <h6 class="text-muted mb-3">
                    <i class="ri-user-3-line me-1"></i> Datos B치sicos del Paciente
                </h6>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="TipoDocumento" class="form-label">Tipo de identificaci칩n <span
                            class="text-danger">*</span></label>
                    <select asp-for="TipoDocumento" class="form-select" required>
                        <option value="">Seleccione tipo</option>
                        <option value="CC">C칠dula de Ciudadan칤a</option>
                        <option value="TI">Tarjeta de Identidad</option>
                        <option value="RC">Registro Civil</option>
                        <option value="PA">Pasaporte</option>
                        <option value="CE">C칠dula de Extranjer칤a</option>
                    </select>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio
                    </div>
                </div>
            </div>
            <div class="col-md-6 d-flex">
                <div class="mb-3 col-md-7">
                    <label asp-for="NumeroDocumento" class="form-label">N칰mero de identificaci칩n <span
                            class="text-danger">*</span></label>
                    <input asp-for="NumeroDocumento" type="number" class="form-control" id="NumeroDocumento"
                        placeholder="N칰mero de documento" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio
                    </div>
                </div>
                <div class="mb-3 col-md-5 text-center">
                    <button type="button" class="btn btn-primary" style="margin-top: 28px;" size="sm"
                        id="nextBtnBuscar">
                        <i class="ri-search-line ms-1"></i> Buscar
                    </button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="PrimerNombre" class="form-label">Primer nombre <span
                            class="text-danger">*</span></label>
                    <input type="text" id="PrimerNombre" name="PrimerNombre" class="form-control"
                        placeholder="Primer nombre" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="segundoNombre" class="form-label">Segundo nombre</label>
                    <input type="text" id="segundoNombre" name="SegundoNombre" class="form-control"
                        placeholder="Segundo nombre (opcional)">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="PrimerApellido" class="form-label">Primer apellido <span
                            class="text-danger">*</span></label>
                    <input type="text" id="PrimerApellido" name="PrimerApellido" class="form-control"
                        placeholder="Primer apellido" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="SegundoApellido" class="form-label">Segundo apellido</label>
                    <input type="text" id="SegundoApellido" name="SegundoApellido" class="form-control"
                        placeholder="Segundo apellido (opcional)">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="FechaNacimiento" class="form-label">
                        <i class="ri-calendar-line me-1"></i> Fecha de nacimiento <span class="text-danger">*</span>
                    </label>
                    <input asp-for="FechaNacimiento" id="FechaNacimiento" type="date" class="form-control"
                        pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">Esquema completo</label>
                    <div class="d-flex gap-3 mt-2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="EsquemaCompleto" id="EsquemaCompleto"
                                value=true>
                            <label class="form-check-label" for="esquemaSi">SI</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="EsquemaCompleto" id="EsquemaCompleto"
                                value=false>
                            <label class="form-check-label" for="esquemaNo">NO</label>
                        </div>
                    </div>
                </div>
            </div>
            <div id="edadCalculada" class="mt-3" style="display: none;">
                <div class="card border-primary border-1 bg-light">
                    <div class="card-header bg-primary text-white py-2">
                        <h6 class="mb-0">
                            <i class="ri-time-line me-1"></i> Edad Calculada
                        </h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <div class="col-3">
                                <div class="text-center">
                                    <div class="display-6 fw-bold text-primary" id="edadAnios">0</div>
                                    <small class="text-muted">A침os</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="text-center">
                                    <div class="display-6 fw-bold text-success" id="edadMeses">0</div>
                                    <small class="text-muted">Meses</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="text-center">
                                    <div class="display-6 fw-bold text-info" id="edadDias">0</div>
                                    <small class="text-muted">D칤as</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="text-center">
                                    <div class="display-6 fw-bold text-warning" id="totalMeses">0</div>
                                    <small class="text-muted">Total meses</small>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <div class="text-center">
                                <span class="badge bg-secondary" id="totalDias">0 d칤as totales</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Ocultar los estilos de error de Bootstrap hasta que se valide */
    .form-control:invalid,
    .form-select:invalid {
        border-color: #ced4da !important;
        background-image: none !important;
    }
    
    /* Solo mostrar estilos de error cuando tenga la clase validation-attempted */
    .validation-attempted .form-control.is-invalid,
    .validation-attempted .form-select.is-invalid {
        border-color: #dc3545 !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.7.8-1.2 1.2 1.2 1.2-.7.8-1.2-1.2-1.2 1.2-.7-.8L4.1 6 2.9 4.8l.7-.8L4.8 5.2z'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat !important;
        background-position: right calc(0.375em + 0.1875rem) center !important;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
    }
    
    /* Estilos para campos v치lidos despu칠s de validaci칩n */
    .validation-attempted .form-control.is-valid,
    .validation-attempted .form-select.is-valid {
        border-color: #198754 !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='m2.3 6.73.94-.94 1.94 1.94L7.6 5.31l.94.94-3.72 3.72z'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat !important;
        background-position: right calc(0.375em + 0.1875rem) center !important;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
    }
</style>

<script>
    // Variable global para saber si ya se intent칩 validar
    window.datosBasicosValidated = window.datosBasicosValidated || false;

    // Funci칩n para validar el paso de datos b치sicos
    window.validateDatosBasicos = function () {
        // Guardar los datos antes de validar
        if (typeof window.saveCurrentStepData === 'function') {
            window.saveCurrentStepData();
        }

        // Marcar que ya se intent칩 validar
        window.datosBasicosValidated = true;
        
        // Agregar clase al contenedor para activar los estilos de validaci칩n
        const cardBody = document.querySelector('.card-body');
        if (cardBody) {
            cardBody.classList.add('validation-attempted');
        }
        
        let isValid = true;

        // Obtener todos los campos obligatorios
        const requiredFields = [
            { selector: 'select[name="TipoDocumento"]', name: 'Tipo de documento' },
            { selector: 'input[name="NumeroDocumento"]', name: 'N칰mero de identificaci칩n' },
            { selector: 'input[name="PrimerNombre"]', name: 'Primer nombre' },
            { selector: 'input[name="PrimerApellido"]', name: 'Primer apellido' },
            { selector: 'input[name="FechaNacimiento"]', name: 'Fecha de nacimiento' }
        ];

        // Validar cada campo
        requiredFields.forEach(field => {
            const element = document.querySelector(field.selector);
            const validationMessage = element?.parentElement.querySelector('.validation-message');

            if (element && (!element.value || element.value.trim() === '')) {
                isValid = false;
                if (validationMessage) {
                    validationMessage.style.display = 'block';
                }
                element.classList.add('is-invalid');
                element.classList.remove('is-valid');
            } else if (element) {
                if (validationMessage) {
                    validationMessage.style.display = 'none';
                }
                element.classList.remove('is-invalid');
                element.classList.add('is-valid');
            }
        });

        console.log('游댌 Validaci칩n datos b치sicos:', isValid ? 'V츼LIDO' : 'INV츼LIDO');
        return isValid;
    };

    // Funci칩n para resetear el estado de validaci칩n
    window.resetDatosBasicosValidation = function() {
        window.datosBasicosValidated = false;
        
        // Remover clase de validaci칩n del contenedor
        const cardBody = document.querySelector('.card-body');
        if (cardBody) {
            cardBody.classList.remove('validation-attempted');
        }
        
        // Limpiar estilos de validaci칩n de todos los campos
        const allFields = document.querySelectorAll('.form-control, .form-select');
        allFields.forEach(field => {
            field.classList.remove('is-invalid', 'is-valid');
        });
        
        // Ocultar todos los mensajes de error
        const validationMessages = document.querySelectorAll('.validation-message');
        validationMessages.forEach(message => {
            message.style.display = 'none';
        });
        
        console.log('游댃 Estado de validaci칩n de datos b치sicos reseteado');
    };

    // Escuchar cambios en los campos para actualizar validaci칩n en tiempo real (solo despu칠s del primer intento)
    document.addEventListener('DOMContentLoaded', function () {
        const requiredFields = document.querySelectorAll('select[required], input[required]');

        requiredFields.forEach(field => {
            // Evento para input (mientras el usuario escribe)
            field.addEventListener('input', function () {
                if (window.datosBasicosValidated) {
                    updateFieldValidation(this);
                }
            });

            // Evento para change (cuando cambia el valor)
            field.addEventListener('change', function () {
                if (window.datosBasicosValidated) {
                    updateFieldValidation(this);
                }
            });
        });
    });

    // Funci칩n auxiliar para actualizar la validaci칩n de un campo individual
    function updateFieldValidation(field) {
        const validationMessage = field.parentElement.querySelector('.validation-message');
        const isValid = field.value && field.value.trim() !== '';
        
        if (isValid) {
            if (validationMessage) {
                validationMessage.style.display = 'none';
            }
            field.classList.remove('is-invalid');
            field.classList.add('is-valid');
        } else {
            if (validationMessage) {
                validationMessage.style.display = 'block';
            }
            field.classList.add('is-invalid');
            field.classList.remove('is-valid');
        }
    }



</script>    console.log('游꿢 PASO 1 - DATOS B츼SICOS INICIALIZADO');
    console.log('游꿢 PASO 1 - DATOS B츼SICOS INICIALIZADO');
</script>