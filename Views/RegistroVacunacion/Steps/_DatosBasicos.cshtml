@model RegistroVacunacionItemViewModel

<div class="card border-0">
    <div class="card-header bg-primary text-white">
        <h6 class="mb-0 text-white">
            <i class="ri-user-line me-1"></i> Datos Básicos
        </h6>
    </div>
    <div class="card-body">
        <!-- Datos Iniciales -->
        <div class="row mb-4">
            <div class="col-md-12">
                <h6 class="text-muted mb-3">
                    <i class="ri-file-text-line me-1"></i> Datos Iniciales
                </h6>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="consecutivo" class="form-label">Consecutivo</label>
                    <input type="text" id="consecutivo" name="Consecutivo" class="form-control" value="20250930195" readonly>
                    <small class="text-muted">Número generado automáticamente</small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="FechaAtencion" class="form-label">Fecha de atención <span class="text-danger">*</span></label>
                    <input type="date" id="FechaAtencion" asp-for="FechaAtencion" class="form-control" value="2025-01-10">
                    <small class="text-muted">Formato: 01/10/2025</small>
                </div>
            </div>
        </div>

        <!-- Datos Básicos del Paciente -->
        <div class="row">
            <div class="col-md-12">
                <h6 class="text-muted mb-3">
                    <i class="ri-user-3-line me-1"></i> Datos Básicos del Paciente
                </h6>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="TipoDocumento" class="form-label">Tipo de identificación <span class="text-danger">*</span></label>
                    <select asp-for="TipoDocumento" class="form-select" required>
                        <option value="">Seleccione tipo</option>
                        <option value="CC">Cédula de Ciudadanía</option>
                        <option value="TI">Tarjeta de Identidad</option>
                        <option value="RC">Registro Civil</option>
                        <option value="PA">Pasaporte</option>
                        <option value="CE">Cédula de Extranjería</option>
                    </select>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio</div>
                </div>
            </div>
            <div class="col-md-6 d-flex">
                <div class="mb-3 col-md-7">
                    <label asp-for="NumeroDocumento" class="form-label">Número de identificación <span class="text-danger">*</span></label>
                    <input asp-for="NumeroDocumento" type="number" class="form-control" id="NumeroDocumento" placeholder="Número de documento" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio</div>
                </div>
                <div class="mb-3 col-md-5 text-center">
                    <button type="button" class="btn btn-primary" style="margin-top: 28px;" size="sm" id="nextBtnBuscar">
                        <i class="ri-search-line ms-1"></i> Buscar
                    </button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="PrimerNombre" class="form-label">Primer nombre <span class="text-danger">*</span></label>
                    <input type="text" id="PrimerNombre" name="PrimerNombre" class="form-control" placeholder="Primer nombre" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="segundoNombre" class="form-label">Segundo nombre</label>
                    <input type="text" id="segundoNombre" name="SegundoNombre" class="form-control" placeholder="Segundo nombre (opcional)">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="PrimerApellido" class="form-label">Primer apellido <span class="text-danger">*</span></label>
                    <input type="text" id="PrimerApellido" name="PrimerApellido" class="form-control" placeholder="Primer apellido" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="SegundoApellido" class="form-label">Segundo apellido</label>
                    <input type="text" id="SegundoApellido" name="SegundoApellido" class="form-control" placeholder="Segundo apellido (opcional)">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="FechaNacimiento" class="form-label">
                        <i class="ri-calendar-line me-1"></i> Fecha de nacimiento <span class="text-danger">*</span>
                    </label>
                    <input asp-for="FechaNacimiento" id="FechaNacimiento" type="date" class="form-control" pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required>
                    <div class="text-danger small validation-message" style="display: none;">Este campo es obligatorio</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">Esquema completo</label>
                    <div class="d-flex gap-3 mt-2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="EsquemaCompleto" id="EsquemaCompleto" value=true>
                            <label class="form-check-label" for="esquemaSi">SI</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="EsquemaCompleto" id="EsquemaCompleto" value=false>
                            <label class="form-check-label" for="esquemaNo">NO</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Variable global para saber si ya se intentó validar
    window.datosBasicosValidated = window.datosBasicosValidated || false;
    
    // Función para validar el paso de datos básicos
    window.validateDatosBasicos = function() {
        // Guardar los datos antes de validar
        if (typeof window.saveCurrentStepData === 'function') {
            window.saveCurrentStepData();
        }
        
        window.datosBasicosValidated = true;
        let isValid = true;
        
        // Obtener todos los campos obligatorios
        const requiredFields = [
            { selector: 'select[name="TipoDocumento"]', name: 'Tipo de documento' },
            { selector: 'input[name="NumeroDocumento"]', name: 'Número de identificación' },
            { selector: 'input[name="PrimerNombre"]', name: 'Primer nombre' },
            { selector: 'input[name="PrimerApellido"]', name: 'Primer apellido' },
            { selector: 'input[name="FechaNacimiento"]', name: 'Fecha de nacimiento' }
        ];
        
        // Validar cada campo
        requiredFields.forEach(field => {
            const element = document.querySelector(field.selector);
            const validationMessage = element?.parentElement.querySelector('.validation-message');
            
            if (element && (!element.value || element.value.trim() === '')) {
                isValid = false;
                if (validationMessage) {
                    validationMessage.style.display = 'block';
                }
                element.classList.add('is-invalid');
            } else if (element) {
                if (validationMessage) {
                    validationMessage.style.display = 'none';
                }
                element.classList.remove('is-invalid');
            }
        });
        
        return isValid;
    };
    
    // Escuchar cambios en los campos para ocultar mensajes de error cuando se corrijan
    document.addEventListener('DOMContentLoaded', function() {
        const requiredFields = document.querySelectorAll('select[required], input[required]');
        
        requiredFields.forEach(field => {
            field.addEventListener('input', function() {
                if (window.datosBasicosValidated && this.value && this.value.trim() !== '') {
                    const validationMessage = this.parentElement.querySelector('.validation-message');
                    if (validationMessage) {
                        validationMessage.style.display = 'none';
                    }
                    this.classList.remove('is-invalid');
                }
            });
            
            field.addEventListener('change', function() {
                if (window.datosBasicosValidated && this.value && this.value.trim() !== '') {
                    const validationMessage = this.parentElement.querySelector('.validation-message');
                    if (validationMessage) {
                        validationMessage.style.display = 'none';
                    }
                    this.classList.remove('is-invalid');
                }
            });
        });
    });
</script>